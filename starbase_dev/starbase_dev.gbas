// --------------------------------- //
// Project: starbase_dev
// Start: Monday, December 08, 2014
// IDE Version: 12.312


// SETCURRENTDIR("Media") // go to media files
TYPE optionsType
	debugmodus
ENDTYPE

GLOBAL options AS optionsType

main()

FUNCTION main:

	init()

	WHILE TRUE


		SHOWSCREEN
	WEND
ENDFUNCTION

FUNCTION init:

	AUTOPAUSE FALSE
	SYSTEMPOINTER TRUE

	checkCommandline()
	SETSCREEN checkOptions(0), checkOptions(1), checkOptions(2)

ENDFUNCTION

FUNCTION checkCommandline:
LOCAL debuginfo$, count, spl$[]
	debuginfo$ = GETCOMMANDLINE$()

	count = SPLITSTR(debuginfo$, spl$[], " -")
	
	IF count = 2
		IF spl$[1] = "debug"
			options.debugmodus = TRUE
		ENDIF
	ENDIF

ENDFUNCTION

FUNCTION checkOptions: id
LOCAL error
STATIC ok, found
STATIC resX, resY, full

	ok = DOESFILEEXIST("options.ini")

	// Initialisierung wird erzeugt
	IF found  = FALSE

		IF ok = TRUE
			resX = optionsFound(0)
			resY = optionsFound(1)
			full = optionsFound(2)

			IF resX = -1 OR resY = -1 OR full = -1
				KILLFILE "options.ini"
				optionsNotFound()
				resX = 1024
				resY = 768
				full = 0
			ENDIF


		ENDIF
		IF ok = FALSE
			optionsNotFound()
			resX = 1024
			resY = 768
			full = 0
		ENDIF

		found = TRUE
	ENDIF

	// Initialisierung durchgeführt
	IF id = 0 THEN RETURN resX
	IF id = 1 THEN RETURN resY
	IF id = 2 THEN RETURN full

ENDFUNCTION

FUNCTION optionsFound: id
LOCAL info$, info, error$

	INIOPEN "options.ini"
		IF id = 0 THEN info$ = INIGET$("options", "resX")
		IF id = 1 THEN info$ = INIGET$("options", "resY")
		IF id = 2 THEN info$ = INIGET$("options", "full")

		TRY
			info = info$
			IF MOD(info, 8) <> 0 THEN THROW "not8"
		CATCH error$
			IF error$ = "not8" THEN info$ = "-1"
		FINALLY

		RETURN info$
	INIOPEN ""

ENDFUNCTION

FUNCTION optionsNotFound:

	INIOPEN "options.ini"
		INIPUT "options", "resX", "1024"
		INIPUT "options", "resY", "768"
		INIPUT "options", "full", "0"
	INIOPEN ""

ENDFUNCTION